# **Using a Load Balancer for a Stable Domain**

--> Explaining **why your public IP keeps changing**, how the **load balancer fixes that**, and how to correctly configure health checks and security groups so your service stays healthy and reachable through a stable domain-like URL.

---

## üî• **1. The Problem: Public IP Changes on Every Deployment**

When you redeploy or update your ECS task:

* AWS gives the task a **new public IP**.
* This means your API endpoint changes constantly ‚Üí very impractical.

---

## üü¶ **2. The Solution: Application Load Balancer (ALB)**

Your ALB automatically provides a **stable DNS name** like:

```
ecs-lb-123456.eu-central-1.elb.amazonaws.com
```

You can use this URL like a domain:

```
<LOAD-BALANCER-DNS>/goals
```

But‚Ä¶ initially it won't work because of misconfigurations.

---

# ‚ö†Ô∏è 3. Why It Wasn't Working (Two Mistakes)

---

## ‚ùå **A) Wrong Health Check Path**

By default, ALB sends health checks to:

```
/
```

But your backend **does NOT handle `GET /`**, so the server returns `404`, which makes ALB think the service is **unhealthy**.

Result:

* ECS tasks keep getting **stopped and restarted** endlessly.
* Your load balancer has **no healthy targets** to route requests to.

### ‚úî Fix: Change Health Check Path to `/goals`

In EC2 Console ‚Üí Target Groups ‚Üí Health check settings:

* **Path:** `/goals`

Now ALB hits an endpoint that returns **200 OK**, so tasks stay healthy.

---

## ‚ùå **B) Wrong Security Group on the Load Balancer**

You initially attached only the **default security group** to the ALB.

But your ECS service uses a **goals-security-group**, and traffic must be allowed between them.

### ‚úî Fix: Attach the ECS security group to the ALB

Under Load Balancer ‚Üí Configure:

* Add **your ECS service security group**
* Keep or remove default SG as needed

This ensures:

* Load balancer can reach ECS tasks
* Incoming traffic is allowed on port 80

---

# ‚≠ê 4. After Applying Fixes

Once health checks and security groups are correct:

* ECS tasks remain **running**, not restarting
* ALB marks them as **healthy**
* Requests to the ALB domain **finally work**

Example:

```
http://<ALB-DNS>/goals
```

You can now:

* Add goals (POST)
* View goals (GET)
* Delete goals (DELETE)

And these will continue to work even after redeployments.

---

# üîó **5. Stable Domain Forever**

You no longer depend on changing public IPs.
You can even attach your **own custom domain** (via Route 53 ‚Üí CNAME to ALB DNS).

---

# üéâ **End Result**

You now have:

‚úî A multi-container app (Node + Mongo)
‚úî Running on AWS ECS Fargate
‚úî Connected through an Application Load Balancer
‚úî With a **stable, unchanging domain**
‚úî And correct health checks & security groups

This becomes a professional production-style deployment.
