# **Introducing Multi-Stage Builds**

**Multi-stage builds** allow you to define **multiple build stages** inside *one* Dockerfile.
Each stage:

* Can use its own base image
* Can copy files/artifacts from previous stages
* Helps you separate **build-time** dependencies from final **runtime** dependencies
* Produces *much smaller* final images

This is exactly what‚Äôs needed for deploying a **React production app**, because:

* You need **Node.js** only for building the app
* You need **NGINX** for serving the built static files
* You do *not* want Node.js inside the final production image

---

# ‚≠ê **How Multi-Stage Builds Work**

A multi-stage Dockerfile uses **multiple `FROM` statements**:

* Each `FROM` starts a new *stage*
* Previous stages are discarded **unless** you copy files from them
* You can name a stage using `AS <name>`
* You can copy files from a stage with:

  ```
  COPY --from=<stage_name> <source> <destination>
  ```

You can build either:

* The **entire Dockerfile** (all stages), or
* Only **up to a specific stage**

---

# üìå **Applying Multi-Stage Builds to the React App**

### **Stage 1: Build the optimized frontend**

This stage:

* Uses Node.js
* Installs dependencies
* Copies source code
* Runs:

```
npm run build
```

‚Üí This produces the optimized files in `/app/build`.

Example conceptually:

```
FROM node:24-alpine AS build
WORKDIR /app
COPY package.json .
RUN npm install
COPY . .
RUN npm run build
```

After this stage you have the **final static frontend files**.

---

# üìå **Stage 2: Serve the built files with NGINX**

Now you switch to a completely different base image:

```
FROM nginx:stable-alpine
```

You then copy the built files from the **build stage**:

```
COPY --from=build /app/build /usr/share/nginx/html
```

Why this folder? Because:

* `/usr/share/nginx/html` is the default directory NGINX serves static content from

Next, expose port **80** because that is NGINX‚Äôs default internal port:

```
EXPOSE 80
```

Finally, start NGINX using the recommended command:

```
CMD ["nginx", "-g", "daemon off;"]
```

The `daemon off;` argument is required to keep NGINX in the **foreground**, so Docker doesn‚Äôt think the process exited.

---

# üéâ **Result of Multi-Stage Build**

Your final production Docker image:

* Contains **only NGINX** + **your built frontend files**
* Does **NOT** contain:

  * Node.js
  * Your source code
  * Development dependencies
* Is **much smaller and faster**
* Is production-ready

This is the exact use-case multi-stage builds were designed for.