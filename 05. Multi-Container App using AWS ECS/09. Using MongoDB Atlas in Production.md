# **Using MongoDB Atlas in Production**

--> Explaining how to **remove your on-AWS MongoDB container** and switch your production backend on AWS ECS to **use MongoDB Atlas instead**.

The goal:

âœ” Stop using MongoDB inside ECS
âœ” Remove the EFS volume
âœ” Update the backend container configuration
âœ” Rebuild + push a new Docker image
âœ” Deploy the updated backend to ECS
âœ” Confirm everything works with Atlas

---

# ğŸŸ¦ 1. Update ECS Task Definition (Remove MongoDB Container)

Go to:

**AWS ECS â†’ Task Definitions â†’ goals â†’ Create new revision**

Then:

### âŒ Remove the MongoDB container

You delete the MongoDB container from the task definition because Atlas is now your database.

### âŒ Remove the volume

Since MongoDB container is gone, the EFS volume is unnecessary.

Then also clean up AWS resources:

* **Delete the EFS file system** used for MongoDB storage
* **Delete the security group** created specifically for the EFS mount

(Not required, but good housekeeping.)

---

# ğŸŸ¦ 2. Update the Node.js Backend Container Config in ECS

Still inside the new revision of the task definition:

### Update environment variables:

#### Old:

* local hostname (`mongo`)
* local port
* old connection string
* no Atlas variables

#### New (from Atlas):

* `MONGODB_CONNECTION_STRING` â†’ Atlas URL
* `MONGODB_USERNAME`
* `MONGODB_PASSWORD`
* `MONGODB_DATABASE` â†’ **goals** (production DB)

Important:

* In development you used `goals-dev`
* In production you use **goals**

This ensures data separation between dev and prod.

Click **Update** â†’ **Create new revision**

---

# ğŸŸ¦ 3. Redeploy the Service Using the New Task Definition

Go to:

**ECS â†’ Services â†’ goals â†’ Update**

* Select the latest task definition revision
* You can now switch back to the "latest platform version" because EFS is no longer used
* Click **Force new deployment**
* Save

ECS will terminate the old task and start a new one with the updated configuration.

---

# ğŸŸ¦ 4. Important Step: Rebuild and Push Your Updated Docker Image

```
docker build -t nidhalhaamdii/goals-node .
docker login
docker push nidhalhaamdii/goals-node
```

Now ECS can use the updated image.

---

# ğŸŸ¦ 5. Force Another Deployment

After pushing the updated image:

* Go back to your ECS service
* Click **Update Service**
* Select **Force new deployment**

Now ECS will:

âœ” pull the latest image from Docker Hub
âœ” run the backend with Atlas settings
âœ” start the new task

---

# ğŸŸ¦ 6. Test the Application

Use Postman or your browser to call the load balancer URL:

```
<load-balancer-url>/goals
```

Expected results:

* First request â†’ empty `[]` (new database)
* POST request to add a new goal â†’ works
* GET request again â†’ shows the new goal

Your app is now using:

âœ” MongoDB Atlas
âœ” No local DB container
âœ” No EFS volume
âœ” Persistent, managed, cloud database

---

# ğŸŸ¦ 7. Why Use MongoDB Atlas?

Benefits:

* Fully managed database
* Automatic backups
* High availability by default
* No need to maintain containers for DB
* Easily scalable
* Removes complexity (volumes, EFS, networking, etc.)

Unless youâ€™re a database expert who prefers managing everything manually, managed DB services like Atlas can save a lot of time and headaches.

---

# ğŸ‰ Final Result

Your production system now runs:

* **Node.js backend in ECS**
* **Load balancer forwarding requests**
* **MongoDB Atlas handling all database storage**

You no longer rely on:

* Database containers
* EFS volumes
* Custom AWS DB setup

Your application is now more scalable, more reliable, and easier to maintain.
