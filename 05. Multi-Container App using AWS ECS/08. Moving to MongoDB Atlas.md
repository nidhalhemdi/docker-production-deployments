# **Moving to MongoDB Atlas**

MongoDB Atlas is a **managed**, cloud-hosted MongoDB service.
It handles backups, security, scaling, availability, and performance so you donâ€™t have to manage your own MongoDB containers.

This section shows how to:

âœ”ï¸ create a free MongoDB Atlas cluster
âœ”ï¸ connect your Node.js backend to Atlas
âœ”ï¸ adjust your local Docker Compose setup
âœ”ï¸ prepare for production deployment

Letâ€™s go step by step.

---

# ğŸŸ¦ **1. Create a MongoDB Atlas Cluster**

1. Visit **mongodb.com** â†’ click **Start Free**
2. Sign up
3. Create a new **cluster**
4. Choose **Shared Cluster (M0 Sandbox)** â†’ Free
5. Choose cloud provider (AWS, GCP, Azure) â€” **doesnâ€™t matter**
6. Create the cluster and wait for it to finish deploying.

A "cluster" here is different from ECS clusters â€” itâ€™s simply MongoDB terminology.

---

# ğŸŸ¦ **2. Get Your Connection String**

Click **Connect â†’ Connect your application**.

Atlas shows something like:

```
mongodb+srv://USERNAME:PASSWORD@cluster0.xxxxxx.mongodb.net/myDatabase?retryWrites=true&w=majority
```

Differences vs. your old local connection:

* uses `mongodb+srv://`
* no port number
* has a domain instead of container hostname
* slightly different query parameters

You will copy this string into your backend configuration.

---

# ğŸŸ¦ **3. Decide: Use Atlas Only in Production or Also in Development?**

Two options:

### **Option A â€” Use Atlas in production only**

Develop locally using:

* MongoDB container locally
* Atlas in production

Problems:

* Must ensure **MongoDB versions match** exactly
  (e.g., local container MongoDB 4.4 vs Atlas 4.2.9 â†’ âŒ possible bugs)

### **Option B â€” Use Atlas in both development and production (recommended)**

âœ” same environment everywhere
âœ” fewer surprises
âœ” no local MongoDB container needed

**The course chooses this option.**

---

# ğŸŸ¦ **4. Update the Backend to Use Atlas**

Update the connection string in your code:

### Old (local)

```
mongodb://username:password@mongo:27017/goals?authSource=admin
```

### New (Atlas)

```
mongodb+srv://USERNAME:PASSWORD@cluster-url.mongodb.net/DB_NAME?retryWrites=true&w=majority
```

You will:

* replace protocol: `mongodb` â†’ `mongodb+srv`
* remove port
* add Atlas query params
* insert username + password from Atlas
* extract the database name and make it **environment-dependent**

---

# ğŸŸ¦ **5. Add a Flexible Database Name (dev vs. prod)**

Add environment variable to your backend:

In code:

```
MONGODB_DATABASE = goals-dev
```

In production, override it with:

```
goals
```

This avoids mixing dev and prod data.

---

# ğŸŸ¦ **6. Update Docker & Local Development Setup**

Since Atlas replaces your MongoDB container:

### In `docker-compose.yml`:

âŒ Remove MongoDB service
âŒ Remove `depends_on: mongo`
âŒ Remove MongoDB volumes
âŒ Remove MongoDB environment file (mongo.env)

Only the backend service remains.

### In `backend.env`:

Add the Atlas connection string
Add the database name variable
Add Atlas username & password

---

# ğŸŸ¦ **7. Handle MongoDB Atlas Security**

Atlas has **Network Access** and **Database Users**.

### **Network Access**:

Allow connections from:

* your local IP
* OR allow "Access from anywhere" (0.0.0.0/0)
  (needed for AWS ECS to connect!)

### **Database Users**:

Create a database user:

* Read & Write access
* Set username & password
* Use that in your backend `.env`

Example:

```
USERNAME = nidhal
PASSWORD = <generated password>
```

---

# ğŸŸ¦ **8. Test the Local Setup**

Run:

```
docker-compose up
```

If the Atlas whitelist + credentials are correct, backend logs will show:

âœ” connected to MongoDB successfully

Then open:

```
http://localhost/goals
```

You should see:

```
[]
```

(empty database â†’ meaning connection works!)

---

# ğŸ‰ **Result**

You have now:

âœ” Removed the MongoDB container
âœ” Connected to MongoDB Atlas
âœ” Made backend environment variables production-ready
âœ” Ensured development & production use identical database versions
âœ” Prepared your backend for deployment to AWS ECS
